import Head from 'next/head'
import { useState, useEffect } from 'react';
import { signIn, signOut, useSession } from "next-auth/client";
import Link from "next/link";
import Layout from '../components/layout';
import LoginCover from '../components/LoginCover';
import styled from 'styled-components';
import { useRouter } from 'next/router'

const PageContainer= styled.div`
  align-items: center;
  display: flex;
  flex-direction: column;
`;

const OuterTitleContainer = styled.div`
  display: flex;
  height: 80px;
  margin: 0;
  width: 900px;

  @media (max-width: 1250px) {
    width: auto;
  }
`;

const InnerTitleContainer = styled.div`
  margin: auto 0;
  font-size: 40px;
  font-weight: 400;
  width: 900px;
  display: flex;
  justify-content: space-between;
  height: 80px;
  align-items: center;

  h1 {
    font-size: 34px;
  }

  @media (max-width: 1250px) {
    justify-content: center;
    width: auto;
  }
`;

const CardsContainer= styled.div`
  display: flex;
  justify-content: space-between;
  width: 900px;

  @media (max-width: 1250px) {
    width: auto;
  }
`;

const CardsListContainer= styled.div`
  display: flex;
  flex-direction: row;
  width: 900px;
  justify-content: space-between;

  @media (max-width: 1250px) {
    width: auto;
    flex-direction: column;
    align-items: center;
  }
`;

const Card = styled.div`
  border-radius: 5px;
  width: 250px;
  color: #cad1dc;
  background: #FFFFFF;
  box-shadow: 0 3px 0px 0px;
  height: 125px;
  padding: 0px 20px;
  margin: 0 0 25px 0;
  display: flex;
  justify-content: space-between;

  a {
    color: black;
  }

  p {
    color: black;
    font-size: 20px;
  }
`;

export default function Dashboard() {
  const [session, loading] = useSession();
  const router = useRouter();
  const [algorithmsCount, setAlgorithmsCount] = useState(null);
  const [jobsCount, setJobsCount] = useState(null);
  const [projectsCount, setProjectsCount] = useState(null);

  useEffect(() => {
    const fetchData = async () => {
      const res = await fetch("/api/dashboard");
      const json = await res.json();
      console.log(json.data);
      if(json.data){
        setAlgorithmsCount(json.data.algorithms);
        setJobsCount(json.data.jobs);
        setProjectsCount(json.data.projects);
      }
    }

    fetchData();
  }, [session]);

  if( typeof window !== "undefined" && loading) return null;

  if(!session) {
    return (
      <>
        <LoginCover signIn={signIn}/>
      </>
    )
  }

  return (
    <Layout page={'home'}>
      <Head>
        <title>Job Tracker</title>
        <meta name="Job Tracker App for Programmers" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <PageContainer>
        <OuterTitleContainer>
          <InnerTitleContainer>
            <h1>Dashboard</h1>
          </InnerTitleContainer>
        </OuterTitleContainer>
        <CardsContainer>
          <CardsListContainer>
            <Link href="/" style={{color: 'black'}}>
              <Card>
                <p>Algorithms</p>
                <p>{algorithmsCount}</p>
              </Card>
            </Link>
            <Link href="/" style={{color: 'black'}}>
              <Card>
                <p>Jobs</p>
                <p>{jobsCount}</p>
              </Card>
            </Link>
            <Link href="/" style={{color: 'black'}}>
              <Card>
                <p>Projects</p>
                <p>{projectsCount}</p>
              </Card>
            </Link>
          </CardsListContainer>
        </CardsContainer>
      </PageContainer>
    </Layout>
  )
}
